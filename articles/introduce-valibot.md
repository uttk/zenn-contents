---
title: "ãƒãƒªãƒãƒªè»½é‡No.1ãªæ¤œè¨¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒª Valibot ã®ç´¹ä»‹"
emoji: "ğŸ‘¹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["valibot"]
published: true
---


## ã“ã®è¨˜äº‹ã«ã¤ã„ã¦

ã“ã®ä¸–ã¯ã‚ã‹ã‚‰ãªã„ã€€å€¤ãŒãŸãã•ã‚“ã‚ã‚‹ã€€ã©ã‚“ãªå€¤ãŒæ¥ã¦ã‚‚ã€€è² ã‘ãªã„å‡¦ç†ã‚’æ›¸ã“ã†
ãã‚Œã§ã‚‚è„†å¼±æ€§ã€€å¿…ãšã‚ã‚‹ã‚‚ã‚“ã ã€€å®ˆã£ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€€ãã‚ŒãŒå¼·ã•ãªã‚“ã 
ä»Šæ—¥ã‹ã‚‰ä¸€ç•ªã€€ãŸãã¾ã—ã„ã®ã ã€€ãŠå¾…ãŸã›ã—ã¾ã—ãŸã€€å‡„ã„å¥´
ä»Šæ—¥ã‹ã‚‰ä¸€ç•ªã€€ã‚«ãƒƒã‚³ã‚¤ã‚¤ã®ã ã€€ãƒãƒªãƒãƒªè»½é‡No.1ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª Valibot ã®ç´¹ä»‹è¨˜äº‹ã§ã™ã€‚

ãªã‚‹ã»ã©ï½ã£ã¦ãªã£ãŸã¨ã“ã‚ã§ã€ãƒ›ãƒ³ãƒˆä»Šæ—¥ã‹ã‚‰ ä¸€ç•ª ä¸€ç•ªã  ä¸€ç•ª!!ã‚’ç›®æŒ‡ã—ã¦è§£èª¬ã—ã¦ã„ã“ã†ã‹ã¨æ€ã„ã¾ã™ğŸŒ¸


## Valibot ã«ã¤ã„ã¦

https://valibot.dev/

JavaScript / TypeScript ã§ä½¿ãˆã‚‹æ¤œè¨¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
ç‰¹å¾´ã¨ã—ã¦ã¯ã€

- å¼·åŠ›ãªå‹æ¨è«–ã«ã‚ˆã‚‹å‹ç”Ÿæˆ
- 600 ãƒã‚¤ãƒˆæœªæº€ã®å°ã•ãªãƒãƒ³ãƒ‰ãƒ« ã‚µã‚¤ã‚º
- å¤šãã®å¤‰æ›ãŠã‚ˆã³æ¤œè¨¼å‡¦ç†ãŒå«ã¾ã‚Œã¦ã„ã¾ã™
- ä¾å­˜é–¢ä¿‚ãŒã‚¼ãƒ­
- æœ€å°é™ã§èª­ã¿ã‚„ã™ã„API

ãªã©ã‚ã‚Šã¾ã™ã€‚

å€‹äººçš„ã«ã¯ `æœ€å°é™ã§èª­ã¿ã‚„ã™ã„API` ãŒã¨ã¦ã‚‚è‰¯ã„ç‚¹ã ã¨æ€ã£ã¦ã„ã¦ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦‹ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã«ãªã£ã¦ã„ã¾ã™ ğŸ‘‡

![](https://storage.googleapis.com/zenn-user-upload/a9d963c25583-20240627.png)
*https://valibot.dev/guides/mental-model/ ã‚ˆã‚Šå¼•ç”¨*

schema ã§ â€å‹â€ ã‚’æ¤œè¨¼ã—ã€action ã§ â€å€¤â€ ã‚’å‡¦ç†ã—ã€ãã‚Œã‚‰ã‚’ pipe ã§ã¾ã¨ã‚ã‚‹ã€‚ã¨è¨€ã£ãŸæ§‹é€ ã«ãªã£ã¦ã„ã¦ã€Zod ãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã§è¨˜è¿°ã™ã‚‹æ–¹æ³•ã‚ˆã‚Šè¨˜è¿°é‡ã¯å¤šããªã£ã¦ã—ã¾ã†ã‚“ã§ã™ãŒã€ãã‚Œãã‚Œã®å½¹å‰²ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ã„ã¦ã€ã¨ã¦ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„ API ã«ãªã£ã¦ã¾ã™ã€‚

æœ€è¿‘ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯é–¢æ•°å‹ã£ã½ã„è¨˜è¿°ãŒå¢—ãˆã¦ã„ã‚‹ã®ã§ã€valibot ã® API è¨­è¨ˆã®æ–¹ãŒãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã§è¨˜è¿°ã™ã‚‹ã‚ˆã‚Šã‚‚ä»Šã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã‚ã£ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã‹ãªï½ã¨å€‹äººçš„ã«æ€ã£ã¦ã„ã¾ã™ã€‚


ã‚ã¨ã€ãã‚ãã‚ï¼Ÿãƒ¡ã‚¸ãƒ£ãƒ¼ãƒªãƒªãƒ¼ã‚¹ãŒç™ºè¡¨ã•ã‚Œã‚‹ãã†ãªã®ã§ã€ä»Šã®ã†ã¡ã«è§¦ã£ã¦ãŠãã®ã‚‚ã‚¢ãƒªã‚ˆã‚Šã®ã‚¢ãƒªã ã¨æ€ã„ã¾ã™ã€‚

https://github.com/fabian-hiller/valibot/releases/tag/v1.0.0-beta.1


## å®Ÿè¡Œç’°å¢ƒã«ã¤ã„ã¦

è¨˜äº‹å†…ã®å®Ÿè£…ã¯ä»¥ä¸‹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§è¡Œã£ã¦ã„ã¾ã™ã€‚

```json:valibot ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
"dependencies": {
  "valibot": "0.42.1"
}
```


## åŸºæœ¬çš„ãªä½¿ã„æ–¹

æ¤œè¨¼ã—ãŸã„å‹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œã‚Šã€ãã®ã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ã£ã¦æ¤œè¨¼ã—ã¾ã™ã€‚


```ts:parse()ã‚’ä½¿ã£ãŸä¾‹
import * as v from "valibot";

const StringSchema = v.string(); // ã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆ

const inputValue: unknown; // å…¥åŠ›å€¤ã‚’å®šç¾©

try {
  // ã“ã“ã§æ¤œè¨¼ã™ã‚‹ãŒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«å¼•ã£ã‹ã‹ã‚‹ã¨ throw ã™ã‚‹ã®ã§æ³¨æ„ï¼
  const result: string = v.parse(StringSchema, inputValue);
  console.log(`${result.output} is string`);
} catch (e: unknown) {
  // valibot ã®ã‚¨ãƒ©ãƒ¼ã‹åˆ¤å®šã—ã¾ã™ 
  if (v.isValiError(e)) console.error(e);
}
```

### throw ã•ã›ãªã„ã§æ¤œè¨¼ã™ã‚‹

ä¸Šè¨˜ã®ã‚ˆã†ã« `v.parse()` ã ã¨æ¤œè¨¼ã«å¼•ã£ã‹ã‹ã£ãŸæ™‚ã« throw ã™ã‚‹ã®ã§ã€throw ã•ã›ãŸããªã„å ´åˆã¯ `v.safeParse()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```ts:safeParse()ã‚’ä½¿ã£ãŸä¾‹
import * as v from "valibot";

const StringSchema = v.string(); // ã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆ

const inputValue: unknown; // å…¥åŠ›å€¤ã‚’å®šç¾©

const result = v.safeParse(StringSchema, inputValue); // æ¤œè¨¼ã™ã‚‹

if (result.success) console.log(`${result.output} is string`);
else console.error(new v.ValiError(result.issues));
```

æ³¨æ„ç‚¹ã¨ã—ã¦ã€`safeParse()` ã®è¿”ã‚Šå€¤ã«ã¯ `ValiError` ãŒç„¡ã„ãŸã‚ã€ã‚‚ã— `ValiError` ãŒæ¬²ã—ã„ãªã‚‰ `issues` ã®å€¤ã‹ã‚‰å€¤ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ ğŸ‘‡

```ts:ValiErrorã‚’ä½œæˆã™ã‚‹
const result = v.safeParse(StringSchema, inputValue); // æ¤œè¨¼ã™ã‚‹
const error = new v.ValiError(result.issues); // ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹
```

### å‹ã®ç”Ÿæˆ

å®šç¾©ã—ãŸã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰å‹ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚

```ts:å‹ã®ç”Ÿæˆ
import * as v from "valibot";

const Schema = v.object({
  name: v.string(),
  age: v.number(),
})

type UserType = v.InferOutput<typeof Schema>; // { name: string; age: number }
```

ã¾ãŸã€`v.transform()` ãªã©ã§å…¥åŠ›å€¤ã¨å‡ºåŠ›å€¤ã®å‹ãŒé•ã†å ´åˆã¯ã€`v.InferInput<T>` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§å…¥åŠ›å€¤å´ã®å‹ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ts:InferInputã‚’ä½¿ã£ã¦å…¥åŠ›å€¤ã®å‹ã‚‚ç”Ÿæˆã§ãã‚‹
import * as v from 'valibot';

const Schema = v.object({
  date: v.pipe(v.string(), v.transform(str => new Date(str)))
});

type InputType = v.InferInput<typeof Schema> // { date: string; }
type OutputType = v.InferOutput<typeof Schema> // { date: Date; }
```


### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŒ‡å®šã¨ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ(issues)ã«ã¤ã„ã¦

ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã™ã‚‹æ™‚ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã§ãã¾ã™ã€‚

```ts
import * as v from "valibot";

const UserSchema = v.object({
  name: v.string(),
  age: v.number(),
}, "å…¥åŠ›å€¤ã¯ User å‹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ")

try {
  v.parse(UserSchema, value);
} catch (e) {
  console.log(e.message); // â†’ "å…¥åŠ›å€¤ã¯ User å‹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
}
```

ã¾ãŸã€`v.parse()` ãªã©ã§æ¤œè¨¼ã«å¤±æ•—ã™ã‚‹ã¨ã€`ValiError` ã¨ã„ã† Error ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè¿”ã•ã‚Œã¾ã™ã€‚ã“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¯ `issues` ã¨ã„ã†æ¤œè¨¼ã«é–¢ã™ã‚‹æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã®å€¤ã‚’ä½¿ã£ã¦æ¤œè¨¼å¤±æ•—å¾Œã®å‡¦ç†ã‚’ç°¡å˜ã«æ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ ğŸ‘‡

```ts
import * as v from 'valibot';

const Schema = v.pipe(v.string(), v.minLength(8));

try {
  const result = v.parse(Schema, "");
} catch (err) {
  if(!v.isValiError(err)) throw err;

  const issue = err.issues[0]
  console.log(`æ–‡å­—æ•°ã¯${issue.requirement}æ–‡å­—ä»¥ä¸Šã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™`)
  // â†’ æ–‡å­—æ•°ã¯8æ–‡å­—ä»¥ä¸Šã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
}
```


#### ã¾ã¨ã‚

ã¯ã„ã€‚ä»¥ä¸Šã§åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯çµ‚äº†ã§ã™ã€‚
æ¬¡ã‹ã‚‰ã¯ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©æ–¹æ³•ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã—ã‚‡ã†âš—


## string ( æ–‡å­—åˆ—å‹ )

```ts
import * as v from "valibot";

v.string();                            // å˜ç´”ãªæ–‡å­—åˆ—
v.pipe(v.string(), v.length(5))        // å›ºå®šå¹… ( length === 5 )
v.pipe(v.string(), v.minLength(5))     // 5æ–‡å­—ä»¥ä¸Š ( length >= 5 )
v.pipe(v.string(), v.maxLength(5))     // 5æ–‡å­—ä»¥ä¸‹ ( length <= 5 )
v.pipe(v.string(), v.notLength(5))     // 5æ–‡å­—ä»¥å¤– ( length !== 5 )
v.pipe(v.string(), v.email())          // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
v.pipe(v.string(), v.regex(RegExp))    // å¼•æ•°ã«æ¸¡ã—ãŸæ­£è¦è¡¨ç¾ã«ãƒãƒƒãƒã™ã‚‹æ–‡å­—åˆ—
v.pipe(v.string(), v.url())            // URL
v.pipe(v.string(), v.emoji())          // Emoji
v.pipe(v.string(), v.uuid())           // UUID 
v.pipe(v.string(), v.cuid2())          // Cuid2
v.pipe(v.string(), v.ulid())           // ULID
v.pipe(v.string(), v.bic())            // BIC ( SWIFTã‚³ãƒ¼ãƒ‰ )
v.pipe(v.string(), v.bytes(5))         // å›ºå®šãƒã‚¤ãƒˆ
v.pipe(v.string(), v.minBytes(5))      // 5 ãƒã‚¤ãƒˆä»¥ä¸Š
v.pipe(v.string(), v.maxBytes(5))      // 5 ãƒã‚¤ãƒˆä»¥ä¸‹
v.pipe(v.string(), v.notBytes(5))      // 5 ãƒã‚¤ãƒˆä»¥å¤–
v.pipe(v.string(), v.creditCard())     // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç•ªå·
v.pipe(v.string(), v.octal())          // 8é€²æ•°ã®æ–‡å­—åˆ—
v.pipe(v.string(), v.decimal())        // 10é€²æ•°ã®æ–‡å­—åˆ—
v.pipe(v.string(), v.hexadecimal())    // 16é€²æ•°ã®æ–‡å­—åˆ—
v.pipe(v.string(), v.startsWith("@"))  // æœ€åˆãŒ"@"ã®æ–‡å­—åˆ—
v.pipe(v.string(), v.endsWith("@"))    // æœ€å¾ŒãŒ"@"ã®æ–‡å­—åˆ—
v.pipe(v.string(), v.includes("@"))    // "@"ã‚’å«ã‚€æ–‡å­—åˆ—
v.pipe(v.string(), v.excludes("@"))    // "@"ã‚’å«ã¾ãªã„æ–‡å­—åˆ—
v.pipe(v.string(), v.hash(["md5"]))    // "md5"ã®ãƒãƒƒã‚·ãƒ¥æ–‡å­—åˆ—
v.pipe(v.string(), v.hexColor())       // 16é€²æ•°ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰æ–‡å­—åˆ—
v.pipe(v.string(), v.imei())           // IMEI æ–‡å­—åˆ— ( ç«¯æœ«è­˜åˆ¥ç•ªå· )
v.pipe(v.string(), v.ip())             // IPv4 ã¾ãŸã¯ IPv6 æ–‡å­—åˆ—
v.pipe(v.string(), v.ipv4())           // IPv4 æ–‡å­—åˆ—
v.pipe(v.string(), v.ipv6())           // IPv6 æ–‡å­—åˆ—
v.pipe(v.string(), v.isoDate())        // "YYYY-MM-DD" ã®ã‚ˆã†ãªæ–‡å­—åˆ—
v.pipe(v.string(), v.isoDateTime())    // "2023-06-31T00:00" ã®ã‚ˆã†ãªæ–‡å­—åˆ—
v.pipe(v.string(), v.isoTime())        // "hh:mm" ã®ã‚ˆã†ãªæ–‡å­—åˆ—
v.pipe(v.string(), v.isoTimeSecond())  // "hh:mm:ss" ã®ã‚ˆã†ãªæ–‡å­—åˆ—
v.pipe(v.string(), v.isoTimestamp())   // "2023-06-31T00:00:00.000Z" ã®ã‚ˆã†ãªæ–‡å­—åˆ—
v.pipe(v.string(), v.isoWeek())        // "2023-W14" ã®ã‚ˆã†ãªæ–‡å­—åˆ—
v.pipe(v.string(), v.mac())            // 48-bit ã¾ãŸã¯ 64-bit MAC ã‚¢ãƒ‰ãƒ¬ã‚¹
v.pipe(v.string(), v.mac48())          // 48-bit MAC ã‚¢ãƒ‰ãƒ¬ã‚¹
v.pipe(v.string(), v.mac64())          // 64-bit MAC ã‚¢ãƒ‰ãƒ¬ã‚¹
```

#### email() ã«ã¤ã„ã¦

ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä»¥ä¸‹ã®æ­£è¦è¡¨ç¾ã‚’ä½¿ã£ã¦æ¤œè¨¼ã•ã‚Œã¦ã„ã‚‹ ğŸ‘‡

```ts
/**
 * Email regex.
 */
export const EMAIL_REGEX =
  /^[\w+-]+(?:\.[\w+-]+)*@[\da-z]+(?:[.-][\da-z]+)*\.[a-z]{2,}$/iu;
```
>å¼•ç”¨: https://github.com/fabian-hiller/valibot/blob/7fa24c480576d5ed59680c56281ce1e2efc29149/library/src/regex.ts#L30-L31

#### url() ã«ã¤ã„ã¦

`new URL()` ã§ãƒ‘ãƒ¼ã‚¹ã§ãã‚‹å€¤ã€‚ã©ã®ã‚ˆã†ãªå€¤ãŒãƒ‘ãƒ¼ã‚¹ã§ãã‚‹ã‹ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ğŸ‘‡

https://developer.mozilla.org/ja/docs/Web/API/URL/URL

#### bytes() ã«ã¤ã„ã¦

æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
ä¾‹ãˆã° `"a"` ãªã‚‰ 1 ãƒã‚¤ãƒˆã§ã™ãŒ `"ã‚"` ã¯ 3 ãƒã‚¤ãƒˆã«ãªã‚‹ã®ã§ã€ãã®è¾ºã‚Šã‚’è€ƒæ…®ã—ãŸæ¤œè¨¼ã«ä½¿ã„ã¾ã™ã€‚ãƒã‚¤ãƒˆæ•°ã‚’æ•°ãˆã‚‹å®Ÿè£…ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ ğŸ‘‡

```ts
const length = new TextEncoder().encode(input).length;
```

>å¼•ç”¨: https://github.com/fabian-hiller/valibot/blob/7fa24c480576d5ed59680c56281ce1e2efc29149/library/src/utils/_getByteCount/_getByteCount.ts#L12-L17

#### creditCard() ã«ã¤ã„ã¦

ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‚«ãƒ¼ãƒ‰ç•ªå·ã¯ `American Express`, `Diners Card`, `Discover`, `JCB`, `Union Pay`, `Master Card`, `Visa`ã€‚

æ³¨æ„ã¨ã—ã¦ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç•ªå·ã¯å˜ç´”ãªæ­£è¦è¡¨ç¾ã‚’ä½¿ã£ã¦æ¤œè¨¼ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ä½¿ç”¨å¯èƒ½ãªç•ªå·ã‹åˆ¤å®šã™ã‚‹ã«ã¯åˆ¥é€”å®Ÿè£…ãŒå¿…è¦ã€‚( ãƒã‚¤ãƒ•ãƒ³ã¯å«ã¾ã‚Œã¦ã„ã¦ã‚‚ OK ğŸ‘Œ )

```ts
const PROVIDER_REGEX_LIST = [
  // American Express
  /^3[47]\d{13}$/u,
  // Diners Club
  /^3(?:0[0-5]|[68]\d)\d{11,13}$/u,
  // Discover
  /^6(?:011|5\d{2})\d{12,15}$/u,
  // JCB
  /^(?:2131|1800|35\d{3})\d{11}$/u,
  // Mastercard
  /^5[1-5]\d{2}|(?:222\d|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{12}$/u,
  // UnionPay
  /^(?:6[27]\d{14,17}|81\d{14,17})$/u,
  // Visa
  /^4\d{12}(?:\d{3,6})?$/u,
];
```

>å¼•ç”¨: https://github.com/fabian-hiller/valibot/blob/7fa24c480576d5ed59680c56281ce1e2efc29149/library/src/actions/creditCard/creditCard.ts#L78-L93

ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç•ªå·ã®ä»•æ§˜ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã® wiki ã‚’å‚ç…§ã¨ã®ã“ã¨ ğŸ‘‡

https://ja.wikipedia.org/wiki/ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã®ç•ªå·

#### hash() ã«ã¤ã„ã¦

æ¤œè¨¼ã§ãã‚‹ãƒãƒƒã‚·ãƒ¥æ–‡å­—åˆ—ã¯ä»¥ä¸‹ã®é€šã‚ŠğŸ‘‡

```ts
type HashType = 
  | 'md4'
  | 'md5'
  | 'sha1'
  | 'sha256'
  | 'sha384'
  | 'sha512'
  | 'ripemd128'
  | 'ripemd160'
  | 'tiger128'
  | 'tiger160'
  | 'tiger192'
  | 'crc32'
  | 'crc32b'
  | 'adler32'
```
> å¼•ç”¨: https://valibot.dev/api/HashType/


## number ( æ•°å€¤å‹ )

```ts
import * as v from "valibot"

v.number()                          // å˜ç´”ãªæ•°å€¤å‹
v.pipe(v.number(), v.finite())      // æœ‰é™ãªå€¤ ( Number.isFinite(n) )
v.pipe(v.number(), v.integer())     // æ•´æ•° ( Number.isInteger(n) )
v.pipe(v.number(), v.minValue(5))   // 5 ä»¥ä¸Š ( n >= 5 )
v.pipe(v.number(), v.maxValue(5))   // 5 ä»¥ä¸‹ ( n <= 5 )
v.pipe(v.number(), v.multipleOf(5)) // 5 ã®å€æ•° ( n % 5 === 0 )
v.pipe(v.number(), v.notValue(5))   // 5 ã§ã¯ãªã„ ( n !== 5 )
v.pipe(v.number(), v.safeInteger()) // å®‰å…¨ãªæ•´æ•° ( Number.isSafeInteger(n) )
v.pipe(v.number(), v.toMinValue(5)) // 5 ä»¥ä¸‹ã®å€¤ã‚’ 5 ã«ã™ã‚‹ ( Math.min(n, 5) )
v.pipe(v.number(), v.toMaxValue(5)) // 5 ä»¥ä¸Šã®å€¤ã‚’ 5 ã«ã™ã‚‹ ( Math.max(n, 5) )
v.pipe(v.number(), v.value(5))      // 5 ã¨ã„ã†æ•° ( n === 5 )
```

:::message
`v.number()` ã¯ [NaN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/NaN) ã‚„ [BigInt](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/BigInt) ã‚’å—ã‘ä»˜ã‘ãªã„ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
:::

#### v.finite() ã«ã¤ã„ã¦

æœ‰é™ãªå€¤ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã¾ã™ãŒã€æ¤œè¨¼ã«ã¯[Number.isFinite()]()ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
ãã®ãŸã‚ã€ã“ã®æ¤œè¨¼ã«å¤±æ•—ã™ã‚‹å€¤ã¯

- æ­£ã®ç„¡é™å¤§ (Infinity)
- è² ã®ç„¡é™å¤§ (Infinity)

ã«ãªã‚Šã¾ã™ã€‚

å‚è€ƒ: 

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Number/isFinite

#### v.safeInteger() ã«ã¤ã„ã¦

å®‰å…¨ãªæ•´æ•°ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã¾ã™ãŒã€æ¤œè¨¼ã«ã¯ [Number.isSafeInteger()](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Number/isSafeInteger) ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

å®‰å…¨ãªæ•´æ•°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå‚è€ƒã«ãªã‚Šã¾ã™ğŸ‘‡

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Number/isSafeInteger#è§£èª¬

### NaN

[NaN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/NaN) ã‚’åˆ¤å®šã™ã‚‹ã«ã¯ã€`v.nan()` ã¨è¨€ã†åˆ¥ã®ã‚¹ã‚­ãƒ¼ãƒã§åˆ¤å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```ts
import * as v from "valibot";

v.nan() // NaN ã‹åˆ¤å®šã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
```

### bigint

[BigInt](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/BigInt) ã‚’åˆ¤å®šã™ã‚‹ã«ã¯ã€`v.bigint()` ã¨è¨€ã†åˆ¥ã®ã‚¹ã‚­ãƒ¼ãƒã§åˆ¤å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


```ts
import * as v from 'valibot';

v.bigint()                           // å˜ç´”ãªæ•°å€¤å‹
v.pipe(v.bigint(), v.minValue(5n))   // 5n ä»¥ä¸Š ( n >= 5n )
v.pipe(v.bigint(), v.maxValue(5n))   // 5n ä»¥ä¸‹ ( n <= 5n )
v.pipe(v.bigint(), v.notValue(5n))   // 5n ã§ã¯ãªã„ ( n !== 5n )
v.pipe(v.bigint(), v.toMinValue(5n)) // 5n ä»¥ä¸‹ã®å€¤ã‚’ 5n ã«ã™ã‚‹
v.pipe(v.bigint(), v.toMaxValue(5n)) // 5n ä»¥ä¸Šã®å€¤ã‚’ 5n ã«ã™ã‚‹ 
v.pipe(v.bigint(), v.value(5n))      // 5n ã¨ã„ã†æ•° ( n === 5n )
```


## boolean ( è«–ç†å‹ )

```ts
import * as v from "valibot";

v.boolean() // è«–ç†å€¤ã®ã‚¹ã‚­ãƒ¼ãƒ
```

:::message
`v.boolean()` ã«ã‚‚ [v.value()](https://valibot.dev/api/value/) ãªã©ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã§ãã¾ã™ãŒã€å–ã‚‹å€¤ãŒ `true` ã‹ `false` ã—ã‹ãªã„ã®ã§ã€ã‚‚ã—ã©ã¡ã‚‰ã‹ã‚’ä¸€æ–¹ã‚’æ¤œè¨¼ã—ãŸã„ãªã‚‰ [`v.literal()`](#comment-4845c6bbce0408) ã‚’ä½¿ç”¨ã—ãŸæ–¹ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
:::


## date ( æ—¥ä»˜å‹ )

```ts
import * as v from "valibot";

const date = new Date(2019, 0, 1)

v.date() // Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
v.pipe(v.date(), v.minValue(date)) // 2019/01/01 ã‚ˆã‚Šå¾Œã®æ—¥ä»˜ (n > date)
v.pipe(v.date(), v.maxValue(date)) // 2019/01/01 ã‚ˆã‚Šå‰ã®æ—¥ä»˜ (n < date)
v.pipe(v.date(), v.value(date)     // 2019/01/01 ã®æ—¥ä»˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

// ç¯„å›²ã‚’è¨­å®šã™ã‚‹ ( 2019/01/01 ~ 2020/01/01 ã¾ã§ã®æ—¥ä»˜ )
v.pipe(
  v.date(),
  v.minValue(new Date(2019, 0, 1))
  v.maxValue(new Date(2020, 0, 1))
)
```


## literal ( ãƒªãƒ†ãƒ©ãƒ«å‹ )

```ts
import * as v from "valibot";

v.literal("foo")          // æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«
v.literal(0)              // æ•°å€¤ãƒªãƒ†ãƒ©ãƒ«
v.literal(true)           // è«–ç†å€¤ãƒªãƒ†ãƒ©ãƒ«
v.literal(Symbol("hoge")) // Symbolãƒªãƒ†ãƒ©ãƒ«
v.literal(BigInt(1))      // BigIntãƒªãƒ†ãƒ©ãƒ«
v.literal(null)           // nullãƒªãƒ†ãƒ©ãƒ«
v.literal(undefined)      // undefinedãƒªãƒ†ãƒ©ãƒ«
```

:::message
è¨­å®šã§ãã‚‹å€¤ã¯ã€`null | undefined | number | string | boolean | symbol | bigint` ã¨ãªã£ã¦ã„ã¾ã™ã€‚
:::


## null

```ts
import * as v from "valibot";

v.null_() // null ã‹åˆ¤å®šã™ã‚‹ãŸã‚ã®ã‚¹ã‚­ãƒ¼ãƒ
```

### nullable ã¨ nonNullable ã«ã¤ã„ã¦

å…¥åŠ›å€¤ã« `null` ã‚’è¨±å®¹ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆã™ã‚‹æ™‚ã«ä½¿ã„ã¾ã™ã€‚

```ts
import * as v from "valibot";

v.nullable(v.string()); // `string | null` ã®ã‚¹ã‚­ãƒ¼ãƒ
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```ts:ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹
import * as v from "valibot";

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
const schema = v.nullable(v.string(), () => "default value");

// é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹
v.nullable(v.string(), () => "default value");

// å‹ã‚’å‡ºåŠ›ã™ã‚‹ã¨ `string | null` ã§ã¯ãªã `string` ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ï¼
type SchemaType = v.InferOutput<typeof schema>

v.parse(schema, "hoge") // â†’ "hoge"
v.parse(schema, null)   // â†’ "default value"
```

ã¾ãŸã€å…ƒã«æˆ»ã™ã«ã¯ `nonNullable` ã‚’ä½¿ç”¨ã—ã¾ã™ ğŸ‘‡

```ts
import * as v from "valibot";

const schema = v.nullable(v.string()); // `string | null` ã®ã‚¹ã‚­ãƒ¼ãƒ
v.nonNullable(schema); // `string` ã®ã‚¹ã‚­ãƒ¼ãƒã«å¤‰æ›
```

### nullish ã¨ nonNullish ã«ã¤ã„ã¦

å…¥åŠ›å€¤ã« `null` ã¨ `undefined` ã‚’è¨±å®¹ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆã™ã‚‹æ™‚ã«ä½¿ã„ã¾ã™ã€‚

```ts
import * as v from "valibot";

v.nullish(v.string()); // `string | null | undefined` ã®ã‚¹ã‚­ãƒ¼ãƒ
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```ts:ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹
import * as v from "valibot";

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
const schema = v.nullish(v.string(),  "default value");

// é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹
v.nullish(v.string(), () => "default value");

// å‹ã‚’å‡ºåŠ›ã™ã‚‹ã¨ `string | null | undefined` ã§ã¯ãªã `string` ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ï¼
type SchemaType = v.InferOutput<typeof schema>

v.parse(schema, "hoge") // â†’ "hoge"
v.parse(schema, null)   // â†’ "default value"
```

ã¾ãŸã€å…ƒã«æˆ»ã™ã«ã¯ `nonNullable` ã‚’ä½¿ç”¨ã—ã¾ã™ ğŸ‘‡

```ts
import * as v from "valibot";

const schema = v.nullish(v.string()); // `string | null | undefined` ã®ã‚¹ã‚­ãƒ¼ãƒ
v.nonNullish(schema); // `string` ã®ã‚¹ã‚­ãƒ¼ãƒã«å¤‰æ›
```

## undefined 

```ts
import * as v from "valibot";

v.undefined_() // undefined ã‹åˆ¤å®šã™ã‚‹ãŸã‚ã®ã‚¹ã‚­ãƒ¼ãƒ
```

### optional ã¨ nonOptional ã«ã¤ã„ã¦

å…¥åŠ›å€¤ã« `undefined` ã‚’è¨±å®¹ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆã™ã‚‹æ™‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```ts
v.optional(v.string()) // `strnig | undefined` ã®ã‚¹ã‚­ãƒ¼ãƒ
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```ts:ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹
import * as v from "valibot";

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
const schema = v.optional(v.string(), "default value");

// é–¢æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹
// v.optional(v.string(), () => "default value");

// å‹ã‚’å‡ºåŠ›ã™ã‚‹ã¨ `string | undefined` ã§ã¯ãªã `string` ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ï¼
type SchemaType = v.InferOutput<typeof schema>

v.parse(schema, "hoge") // â†’ "hoge"
v.parse(schema, null)   // â†’ "default value"
```

ã¾ãŸã€å…ƒã«æˆ»ã™ã«ã¯ `nonOptional` ã‚’ä½¿ç”¨ã—ã¾ã™ğŸ‘‡

```ts
import * as v from "valibot";

const schema = v.optional(v.string()); // `string  | undefined` ã®ã‚¹ã‚­ãƒ¼ãƒ
v.nonOptional(schema); // `string` ã®ã‚¹ã‚­ãƒ¼ãƒã«å¤‰æ›
```


## any / unknown / never / void

ä¸»ã« TypeScript ã®å‹æƒ…å ±ã‚’ä»˜ä¸ã™ã‚‹ãŸã‚ã®ã‚¹ã‚­ãƒ¼ãƒã§ã™ã€‚


```ts
v.any()     // ã©ã‚“ãªå€¤ã«ã‚‚ãƒãƒƒãƒã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
v.unknown() // ã©ã‚“ãªå€¤ã«ã‚‚ãƒãƒƒãƒã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
v.never()   // ã©ã‚“ãªå€¤ã«ã‚‚ãƒãƒƒãƒã—ãªã„ã‚¹ã‚­ãƒ¼ãƒ
v.void_()   // undefined ã‹åˆ¤å®šã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
```

`v.void()` ã«ã¤ã„ã¦ã¯ã€`v.undefined()` ã¨ä¸€ç·’ã§ã™ãŒã€å‹æƒ…å ±ãŒ void ã«ãªã‚Šã¾ã™ã€‚undefined ã¨ void ã®é•ã„ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆãŒåˆ†ã‹ã‚Šã‚„ã™ã‹ã£ãŸã§ã™ğŸ‘‡

https://typescriptbook.jp/reference/functions/void-type


## array ( é…åˆ—å‹ )

```ts
import * as v from "valibot";

v.array(v.string())            // string ã®ã¿ã‚’å«ã‚€é…åˆ—

const arr = v.array(v.string())

v.pipe(arr, v.minLength(5))    // è¦ç´ æ•°ãŒ 5 ä»¥ä¸Šã®é…åˆ— ( n >= 5 )
v.pipe(arr, v.maxLength(5))    // è¦ç´ æ•°ãŒ 5 ä»¥ä¸‹ã®é…åˆ— ( n <= 5 )
v.pipe(arr, v.includes('foo')) // 'foo' ã‚’å«ã‚€é…åˆ—
v.pipe(arr, v.excludes('foo')) // 'foo' ã‚’å«ã¾ãªã„é…åˆ—
v.pipe(arr, v.empty())         // ç©ºé…åˆ—
v.pipe(arr, v.nonEmpty())      // ç©ºé…åˆ—ã§ã¯ãªã„é…åˆ—
v.pipe(arr, v.readonly())      // readonlyãªé…åˆ—
v.pipe(arr, v.every(fn))       // fn ãŒåˆ¤å®šã—ãŸè¦ç´ ãŒå…¨ã¦ true ã‚’è¿”ã—ãŸé…åˆ— 
v.pipe(arr, v.some(fn))        // fn ãŒåˆ¤å®šã—ãŸè¦ç´ ã®ã„ãšã‚Œã‹ãŒ true ã‚’è¿”ã—ãŸé…åˆ—
```

#### v.readonly() ã«ã¤ã„ã¦

å‹æƒ…å ±ã‚’ä»˜ä¸ã™ã‚‹ã ã‘ã§å®Ÿéš›ã®æ¤œè¨¼ã«ã¯ä½•ã‚‚å‡¦ç†ã—ã¾ã›ã‚“ã€‚ä»¥ä¸‹ã¯ valibot ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¼•ç”¨ã§ã™ğŸ‘‡

```ts
export function readonly<TInput>(): ReadonlyAction<TInput> {
  return {
    kind: 'transformation',
    type: 'readonly',
    reference: readonly,
    async: false,
    '~validate'(dataset) {
      return dataset;
    },
  };
}
```

>å¼•ç”¨: https://github.com/fabian-hiller/valibot/blob/7fa24c480576d5ed59680c56281ce1e2efc29149/library/src/actions/readonly/readonly.ts#L23-L33


## map

```ts
import * as v from "valibot";

v.map(v.string(), v.number()) // Map<string, number> ã‹åˆ¤å®šã™ã‚‹ãŸã‚ã®ã‚¹ã‚­ãƒ¼ãƒ

const schema = v.map(v.string(), v.number())
v.pipe(schema, v.minSize(5)) // è¦ç´ æ•°ãŒ 5 ä»¥ä¸Šã® Map ( size >= 5 )
v.pipe(schema, v.maxSize(5)) // è¦ç´ æ•°ãŒ 5 ä»¥ä¸‹ã® Map ( size <= 5 )
v.pipe(schema, v.size(5))    // è¦ç´ æ•° 5 ã® Map ( size === 5 )
```


## set

```ts
import * as v from "valibot";

v.set(v.string()) // Set<string> ã‹åˆ¤å®šã™ã‚‹ãŸã‚ã®ã‚¹ã‚­ãƒ¼ãƒ

const schema = v.set(v.string())
v.pipe(schema, v.minSize(5)) // è¦ç´ æ•°ãŒ 5 ä»¥ä¸Šã® Set ( size >= 5 )
v.pipe(schema, v.maxSize(5)) // è¦ç´ æ•°ãŒ 5 ä»¥ä¸‹ã® Set ( size <= 5 )
v.pipe(schema, v.size(5))    // è¦ç´ æ•° 5 ã® Set ( size === 5 )
```


## object ( ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ )

```ts
import * as v from "valibot";

// { key1: string; key2: number; } ã®ã‚¹ã‚­ãƒ¼ãƒ
v.object({
  key1: v.string(),
  key2: v.number(),
});
```

:::message
`v.object()` ã§ã¯å®šç¾©ã•ã‚Œã¦ãªã„è¦ç´ ã«ã¤ã„ã¦ã¯æ¤œè¨¼ã›ãšã€ã¾ãŸå‡ºåŠ›çµæœã«ã‚‚å«ã‚ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®ä¾‹ã§ã¯æ¤œè¨¼ã«ã¯æˆåŠŸã—ã¾ã™ãŒã€å®šç¾©ã•ã‚Œã¦ã„ãªã„ `key3: "hoge"` ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã¾ã™ ğŸ‘‡

```ts:v.object()ã¯å®šç¾©ã•ã‚Œã¦ãªã„è¦ç´ ã‚’å«ã‚ãªã„ã“ã¨ã«æ³¨æ„ï¼
import * as v from "valibot";

const schema = v.object({
  key1: v.string(),
  key2: v.number(),
});

const input = { key1: "hello", key2: 555, key3: "hoge" };
const result = v.parse(schema, input)

console.log(input)  // â†’ { key1: "hello", key2: 555, key3: "hoge" }
console.log(result) // â†’ { key1: "hello", key2: 555 }
```

ã“ã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„å ´åˆã¯ `v.looseObject()`, `v.strictObject()`, `v.objectWithRest()` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
:::


### looseObject ã«ã¤ã„ã¦

`v.object()` ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€æ¤œè¨¼çµæœã«å®šç¾©ã—ã¦ã„ãªã„è¦ç´ ã‚’å«ã‚€ç‚¹ãŒé•ã„ã¾ã™ã€‚

```ts
import * as v from "valibot";

const Schema = v.looseObject({
  key1: v.string(),
  key2: v.number(),
});

const input = { key1: "hello", key2: 555, key3: "hoge" };
const result = v.parse(Schema, input)

console.log(input)  // ğŸ‘‰ { key1: "hello", key2: 555, key3: "hoge" }
console.log(result) // ğŸ‘‰ { key1: "hello", key2: 555, key3: "hoge" }
```

:::message
æ¤œè¨¼çµæœã«å®šç¾©ã—ã¦ãªã„è¦ç´ ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ãŒã€ãã®è¦ç´ ã¯æ¤œè¨¼ã•ã‚Œã¦ãªã„ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
:::

### strictObject ã«ã¤ã„ã¦

`v.object()` ã§ã¯å®šç¾©ã•ã‚Œã¦ãªã„è¦ç´ ã‚’ç„¡è¦–ã—ã¾ã—ãŸãŒã€ã“ã¡ã‚‰ã®ã‚¹ã‚­ãƒ¼ãƒã¯å³æ ¼ã«ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

```ts
import * as v from "valibot";

const schema = v.strictObject({
  key1: v.string(),
  key2: v.number(),
});

const input = { key1: "hello", key2: 555, key3: "hoge" };

try {
  const result = v.parse(schema, input)
} catch (e) {
  console.error(e)
  // ğŸ‘‰ ValiError: Invalid type: Expected never but received "hoge"
}
```

### objectWithRest ã«ã¤ã„ã¦

`v.object()` ã®ã‚ˆã†ã«å®šç¾©ã—ã¦ãªã„è¦ç´ ã‚’å€¤ç„¡è¦–ã™ã‚‹ã®ã§ã¯ãªãã€åˆ¥ã®ã‚¹ã‚­ãƒ¼ãƒã§æ¤œè¨¼ã—ãŸã„å ´åˆã¯ã“ã¡ã‚‰ã‚’ä½¿ã„ã¾ã™ã€‚

```ts
import * as v from "valibot";

// å®šç¾©ã—ã¦ãªã„è¦ç´ ãŒ null ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
const schema = v.objectWithRest(
  {
    key1: v.string(),
    key2: v.number(),
  },
  v.null_()
);

// å®šç¾©ã—ã¦ãªã„`key3`ãŒ null ãªã®ã§æ¤œè¨¼ã«æˆåŠŸã™ã‚‹
const validInput = { key1: "", key2: 0, key3: null }
const validResult = v.safeParse(schema, validInput)
console.log(validResult) // ğŸ‘‰ { success: true, ... }

// å®šç¾©ã—ã¦ãªã„`key3`ãŒ undefined ãªã®ã§æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã™
const invalidInput = { key1: "", key2: 0, key3: undefined }
const invalidResult = v.safeParse(schema, invalidInput)
console.log(invalidResult) // ğŸ‘‰ { success: false, ... }
```


## tuple

```ts
import * as v from "valibot";

v.tuple([v.string(), v.number()]) // [string, number] ã®ã‚¹ã‚­ãƒ¼ãƒ
```

:::message
`v.tuple()` ã§ã¯å®šç¾©ã•ã‚Œã¦ãªã„è¦ç´ ã«ã¤ã„ã¦ã¯æ¤œè¨¼ã›ãšã€ã¾ãŸå‡ºåŠ›çµæœã«ã‚‚å«ã‚ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã®ä¾‹ã§ã¯æ¤œè¨¼ã«ã¯æˆåŠŸã—ã¾ã™ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ `null` ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã¾ã™ ğŸ‘‡

```ts:v.tuple()ã¯å®šç¾©ã•ã‚Œã¦ãªã„è¦ç´ ã‚’ç„¡è¦–ã™ã‚‹ç‚¹ã«æ³¨æ„ï¼
import * as v from "valibot";

const schema = v.tuple([v.string(), v.number()]) 

const input = ["hello!", 0, null]
const result = v.parse(schema, input)

console.log(input)  // ğŸ‘‰ ["hello!", 0, null]
console.log(result) // ğŸ‘‰ ["hello!", 0]
```

ã“ã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„å ´åˆã¯ `v.looseTuple()`, `v.strictTuple()`, `v.tupleWithRest()` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
:::

### looseTuple ã«ã¤ã„ã¦

`v.tuple()` ã¨ã»ã¨ã‚“ã©åŒã˜ã§ã™ãŒã€æ¤œè¨¼çµæœã«å®šç¾©ã—ã¦ãªã„è¦ç´ ã‚‚å«ã‚ã‚‹ç‚¹ãŒé•ã„ã¾ã™ã€‚

```ts
import * as v from "valibot";

const schema = v.looseTuple([v.string(), v.number()]) 

const input = ["hello!", 0, null]
const result = v.parse(schema, input)

console.log(input)  // ğŸ‘‰ ["hello!", 0, null]
console.log(result) // ğŸ‘‰ ["hello!", 0, null]
```

:::message
æ¤œè¨¼çµæœã«å®šç¾©ã—ã¦ãªã„è¦ç´ ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ãŒã€ãã®è¦ç´ ã¯æ¤œè¨¼ã•ã‚Œã¦ãªã„ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
:::

### strictTuple ã«ã¤ã„ã¦

`v.tuple()` ã§ã¯å®šç¾©ã•ã‚Œã¦ãªã„è¦ç´ ã‚’ç„¡è¦–ã—ã¾ã—ãŸãŒã€ã“ã¡ã‚‰ã®ã‚¹ã‚­ãƒ¼ãƒã¯å³æ ¼ã«ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

```ts
import * as v from "valibot";

const schema = v.strictTuple([v.string(), v.number()]);

const input = ["", 0, null]

try {
  v.parse(schema, input);
} catch (e) {
  console.error(e); 
  // ğŸ‘‰ ValiError: Invalid type: Expected never but received null
}
```

### tupleWithRest ã«ã¤ã„ã¦

`v.tuple()` ã®ã‚ˆã†ã«å®šç¾©ã—ãŸè¦ç´ ä»¥å¤–ã®å€¤ã‚’ç„¡è¦–ã™ã‚‹ã®ã§ã¯ãªãã€åˆ¥ã®ã‚¹ã‚­ãƒ¼ãƒã§æ¤œè¨¼ã—ãŸã„å ´åˆã¯ã“ã¡ã‚‰ã‚’ä½¿ã„ã¾ã™ã€‚

```ts
import * as v from "valibot";

// 2ç•ªç›®ä»¥é™ã®è¦ç´ ãŒnullã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
const schema = v.tupleWithRest([v.string(), v.number()], v.null_());

const validResult = v.safeParse(schema, ["", 0, null])
console.log(validResult) // ğŸ‘‰ { success: true, ... }

const invalidResult = v.safeParse(schema, ["", 0, undefined])
console.log(invalidResult) // ğŸ‘‰ { success: false, ... }
```

ã¾ãŸã€å‹æƒ…å ±ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ğŸ‘‡

```ts:tupleWithRestã‹ã‚‰å‡ºåŠ›ã—ãŸå‹
type SchemaType = v.InferOutput<typeof schema>
// ğŸ‘‰ [string, number, ...null[]]
```


## record

[Record](https://www.typescriptlang.org/docs/handbook/utility-types.html#recordkeys-type) å‹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆã™ã‚‹æ™‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```ts
import * as v from 'valibot';

v.record(v.string(), v.number()) // Record<string, number> ã®ã‚¹ã‚­ãƒ¼ãƒ
```


## intersect ( äº¤å·®å‹ )

äº¤å·®å‹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆã™ã‚‹ã¨ãã«ä½¿ç”¨ã—ã¾ã™ã€‚

```ts
import * as v from 'valibot';

const schema = v.intersect([
  v.object({ foo: v.string() }),
  v.object({ bar: v.number() }),
]);

type SchemaType = v.InferOutput<typeof schema>
// { foo: string } & { bar: number }
```

:::message
`v.intersect()` ã¯æ¤œè¨¼æ™‚ã«æ¸¡ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒã‚’ãã‚Œãã‚Œå®Ÿè¡Œã™ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼
:::


### è¤‡æ•°ã® `v.object()` ã‚’ãƒãƒ¼ã‚¸ã—ãŸã„

`v.intersect()` ã¨ã¯é•ã„è¤‡æ•°ã® `v.object()` ã‹ã‚‰ä¸€ã¤ã® `v.object()` ã‚’ç”Ÿæˆã—ãŸå ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```ts
const fooSchema = v.object({ foo: v.string(), hoge: v.boolean() });
const barSchema = v.object({ bar: v.string(), hoge: v.string() });

const MergedSchema = v.object({
  ...fooSchema.entries,
  ...barSchema.entries,
});

type SchemaType = v.InferOutput<typeof schema>
// { foo: string; bar: string; hoge: string }
```

:::message
é‡è¤‡ã—ã¦ã„ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã£ãŸå ´åˆã¯æœ€å¾Œã«å®šç¾©ã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ä¸Šè¨˜ã®ä¾‹ã§ã¯ `barSchema` ã® `hoge: v.string()` ãŒå„ªå…ˆã•ã‚Œã¦ã„ã¾ã™ã€‚
:::


## union ( ç›´å’Œå‹ )

```ts
import * as v from "valibot";

v.union([v.string(), v.number()]) // `string | number` ã®ã‚¹ã‚­ãƒ¼ãƒ
```

### variant ( åˆ¤åˆ¥å¯èƒ½ãª union ) ã«ã¤ã„ã¦

 [åˆ¤åˆ¥å¯èƒ½ãªãƒ¦ãƒ‹ã‚ªãƒ³å‹ (discriminated union)](https://typescriptbook.jp/reference/values-types-variables/discriminated-union) ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«ã¯ `v.variant()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```ts
import * as v from "valibot";

// åˆ¤åˆ¥å¯èƒ½ãªãƒ¦ãƒ‹ã‚ªãƒ³å‹ ã®ã‚¹ã‚­ãƒ¼ãƒ
v.variant("type", [
  v.object({
    type: v.literal("foo"),
    foo: v.string(),
  }),
  v.object({
    type: v.literal("bar"),
    bar: v.number(),
  }),
]);
```


## enum ( åˆ—æŒ™å‹ )

```ts
import * as v from "valibot";

const MyEnum = { Foo: "FOO", Bar: "BAR" } as const;
v.enum_(MyEnum) // "FOO" | "BAR" ã®åˆ—æŒ™å‹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©

// TypeScript ã® enum ã‚’ä½¿ç”¨ã™ã‚‹äº‹ã‚‚ã§ãã¾ã™
enum MyTsEnum {
  Foo = "FOO",
  Bar = "BAR",
}
v.enum_(MyTsEnum) // "FOO" | "BAR" ã®åˆ—æŒ™å‹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
```

### picklist ( é…åˆ—ã«ã‚ˆã‚‹åˆ—æŒ™å‹ )ã«ã¤ã„ã¦

é…åˆ—ã‹ã‚‰åˆ—æŒ™å‹ã‚’å®šç¾©ã—ãŸã„å ´åˆã¯ `v.picklist()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```ts
import * as v from 'valibot';

v.picklist(['FOO', 'BAR'] as const) // "FOO" | "BAR" ã®åˆ—æŒ™å‹ã®ã‚¹ã‚­ãƒ¼ãƒ
```


## blob

```ts
import * as v from "valibot";

v.blob()                                      // Blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹åˆ¤å®šã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
v.pipe(v.blob(), v.minSize(1024 * 1024 * 10)) // 10MBä»¥ä¸Šã®Blob ( size >= 10MB )
v.pipe(v.blob(), v.maxSize(1024 * 1024 * 10)) // 10MBä»¥ä¸‹ã®Blob ( size <= 10MB )
v.pipe(v.blob(), v.size(1024 * 1024 * 10))    // 10MBã®Blob ( size == 10MB )
v.pipe(v.blob(), v.mimeType(['image/jpeg']))  // JPEGç”»åƒã®Blob
```

:::message
[Blob](https://developer.mozilla.org/ja/docs/Web/API/Blob) ã‚’ç¶™æ‰¿ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚ Blob ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
ä¾‹ãˆã° [File](https://developer.mozilla.org/ja/docs/Web/API/File) ã¯ Blob ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ãŸã‚ã€`v.blob()` ã§æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
:::


## symbol

```ts
import * as v from "valibot";

v.symbol() // Symbolã‹åˆ¤å®šã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
```

:::message
ç‰¹å®šã® Symbol ã‹åˆ¤å®šã—ãŸã„å ´åˆã¯ `v.literal()` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
:::


## instance ( instanceof )

```ts
import * as v from "valibot";

class AnyClass {}

v.instance(AnyClass) // AnyClassã«ãƒãƒƒãƒã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒ
```

å†…éƒ¨çš„ã«ã¯ `instanceof` ã§åˆ¤å®šã—ã¦ã„ã‚‹ã®ã§ã€`insntanceof` ã®æŒ™å‹•ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/instanceof

## custom

ç‹¬è‡ªã®æ¤œè¨¼ã‚’ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã™ã‚‹ã¨ãã«ä½¿ç”¨ã—ã¾ã™ã€‚ä¾‹ãˆã° `"hoge"` ãŒæ–‡å­—åˆ—ã®æœ€å¾Œã«ã‚ã‚‹ã‹æ¤œè¨¼ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ğŸ‘‡

```ts
import * as v from 'valibot';

const schema = v.custom<`${string}ã«ã‚‡`>((input) => {
  return typeof input === "string" && input.endsWith("ã«ã‚‡")
})

type SchemaType = v.InferOutput<typeof schema> 
// `${string}ã«ã‚‡` ã¨ã—ã¦å‹ãŒç”Ÿæˆã•ã‚Œã¾ã™
```

:::message
`v.custom()` ã«å‹å¼•æ•°ã«å‹ã‚’æ¸¡ã•ãªã‹ã£ãŸå ´åˆã€`v.InferOutput<T>` ã§å‡ºåŠ›ã•ã‚Œã‚‹æ–¹ã¯ `unknown` ã«ãªã£ã¦ã—ã¾ã†ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
:::


## lazy ( å†å¸°çš„ãªå‹ )

å†å¸°çš„ãªã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ãŸã„æ™‚ã«ã¯ v.lazy() ã‚’ä½¿ã„ã¾ã™ã€‚

```ts
import * as v from 'valibot';

type BinaryTree = {
  element: string;
  left: BinaryTree | null;
  right: BinaryTree | null;
};

const BinaryTreeSchema: v.GenericSchema<BinaryTree> = v.object({
  element: v.string(),
  left: v.nullable(v.lazy(() => BinaryTreeSchema)),
  right: v.nullable(v.lazy(() => BinaryTreeSchema)),
});
```

:::message
TypeScript ã®åˆ¶ç´„ã«ã‚ˆã‚Šå†å¸°ã‚¹ã‚­ãƒ¼ãƒã® `v.InferOutput<T>` ãªã©ã«ã‚ˆã‚‹å‹ç”Ÿæˆã¯ã§ãã¾ã›ã‚“ã€‚å‹ã‚’ä»˜ã‘ã‚‹å ´åˆã¯ `v.GenericSchema<T>` ã‚’ä½¿ã£ã¦æ˜ç¤ºçš„ã«å‹ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
:::

ã¾ãŸå…¥åŠ›å€¤ã‹ã‚‰ã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆã™ã‚‹äº‹ã‚‚ã§ãã¾ã™ã€‚

```ts
import * as v from 'valibot';

// ã“ã¡ã‚‰ã¯å†å¸°ã‚¹ã‚­ãƒ¼ãƒã§ã¯ç„¡ã„ã®ã§å‹ç”ŸæˆãŒå¯èƒ½ã§ã™
const LazySchema = v.lazy((input) => {
  switch (input) {
    case "foo":
      return v.object({ type: v.literal("foo") });
    case "bar":
      return v.object({ type: v.literal("bar") });
    case "hoge":
      return v.object({ type: v.literal("hoge") });
    default:
      return v.never();
  }
})

type SchemaType = v.InferOutput<typeof LazySchema> 
// { type: "foo"; } | { type: "bar"; } | { type: "hoge"; }
```


## é€†å¼•ããƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆã«ã¤ã„ã¦

ã‚ˆã‚Šå…·ä½“çš„ãªå®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€ã“ã“ã§ç´¹ä»‹ã™ã‚‹ã¨é•·ããªã‚Šã™ãã‚‹ã®ã§ä»¥å‰ä½œã£ãŸã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã®æ–¹ã‚’å‚ç…§ã—ã¦é ‚ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ğŸ™

https://zenn.dev/uttk/scraps/3a51a34ddbdc4a


## ã‚ã¨ãŒã

ã“ã“ã¾ã§èª­ã‚“ã§ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

æ­£ç›´ã«è¨€ã†ã¨ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨è¨˜äº‹ã®å†’é ­éƒ¨åˆ†ã‚’ã‚„ã‚ŠãŸã‹ã£ãŸã ã‘ã§æ›¸ãã¾ã—ãŸã€‚
å¾Œæ‚”ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚€ã—ã‚ã€çˆ½ã‚„ã‹ãªæ°—æŒã¡ã§ã„ã£ã±ã„ã§ã™ğŸ˜Œ

è¨˜äº‹ã®å†…å®¹ã«ã¤ã„ã¦ã¯å‰ã«æ›¸ã„ãŸã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã¨ã»ã¨ã‚“ã©åŒã˜ãªã‚“ã§åˆ¥ã«è¨˜äº‹ã‚’æ›¸ãå¿…è¦ã¯ç„¡ã‹ã£ãŸã‚“ã§ã™ãŒã€ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã ã¨ç›®æ¬¡ãŒå‡ºãªãã¦å€‹äººçš„ã«ã¡ã‚‡ã£ã¨ä¸ä¾¿ã ã£ãŸã®ã§è¨˜äº‹ã¨ã—ã¦æ›¸ãç›´ã—ãŸæ¬¡ç¬¬ã§ã™ğŸ–Š 

é€†å¼•ããƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆã«ã¤ã„ã¦ã¯ã€ä½œã£ãŸã‚‚ã®ã®ã‚ã¾ã‚Šè¦‹ã¦ãªã„ã®ã§ãã®ã¾ã¾ã«ã—ã¦ãŠãã¾ã™ã€‚
ä½•ã‹ã‚ã‚Œã°ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã®æ–¹ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„ã€‚

ã“ã‚ŒãŒèª°ã‹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
è¨˜äº‹ã«é–“é•ã„ãªã©ãŒã‚ã‚Œã°ã€ã‚³ãƒ¡ãƒ³ãƒˆãªã©ã§æ•™ãˆã¦é ‚ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚

ãã‚Œã§ã¯ã¾ãŸ ğŸ‘‹